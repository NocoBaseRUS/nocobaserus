# 国际化

## 基础概念

多语言国际化支持根据服务端和客户端分为两大部分，各自有相应的实现。

语言配置均为普通的 JSON 对象键值对，如果没有翻译文件（或省略编写）的话会直接输出键名中的语言。

### 服务端

服务端的多语言国际化基于 npm 包 [i18next](https://npmjs.com/package/i18next) 实现，在服务端应用初始化时会创建一个 i18next 实例，同时也会将此实例注入到请求上下文（`context`）中，以供在各处方便的使用。

在创建服务端 Application 实例时可以传入配置对应的初始化参数：

```ts
import { Application } from '@nocobase/server';

const app = new Application({
  i18n: {
    defaultNS: 'test',
    resources: {
      'en-US': {
        test: {
          hello: 'Hello',
        },
      },
      'zh-CN': {
        test: {
          hello: '你好',
        }
      }
    }
  }
})
```

或者在插件中对已存在的 app 实例添加语言数据至对应命名空间：

```ts
app.i18n.addResources('zh-CN', 'test', {
  Hello: '你好',
  World: '世界',
});

app.i18n.addResources('en-US', 'test', {
  Hello: 'Hello',
  World: 'World',
});
```

基于应用：

```ts
app.i18n.t('World') // “世界”或“World”
```

基于请求：

```ts
app.resource({
  name: 'test',
  actions: {
    async get(ctx, next) {
      ctx.body = `${ctx.t('Hello')} ${ctx.t('World')}`;
      await next();
    }
  }
});
```

通常服务端的多语言处理主要用于错误信息的输出。

### 客户端

客户端的多语言国际化基于 npm 包 [react-i18next](https://npmjs.com/package/react-i18next) 实现，在应用顶层提供了 `<I18nextProvider>` 组件的包装，可以在任意位置直接使用相关的方法。

在组件中调用翻译函数：

```ts
import { useTranslation } from 'react-i18next';
import { useCompile } from '@nocobase/client';

function MyComponent() {
  const compile = useCompile();

  return (
    <div>
      <p>{compile('{{t("Hello")}}')}</p>
      <p>{useTranslation('World')}</p>
    </div>
  );
}
```

其中 `compile()` 方法是专门针对 SchemaComponent 中纯 JSON 配置提供的编译方法，执行后也可以得到对应的翻译结果。

在 Schema 组件中使用：

```ts
import { SchemaComponent } from '@nocobase/client';

function MySchemaComponent() {
  return (
    <SchemaComponent
      schema={{
        type: 'void',
        title: '{{t("Hello")}}',
        'x-component': 'Action.Drawer',
      }}
    />
  );
}
```

在 SchemaComponent 组件中使用时，可以在配置里直接使用 JSON 的可编译字符串模板表达要翻译的语言片段键名。

## 示例

TODO
